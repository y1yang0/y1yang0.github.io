@import url("https://fonts.googleapis.com/css2?family=Cardo:wght@400;700&family=Cascadia+Code:wght@400;500;600&family=Cormorant+Garamond:wght@400;500;600&family=Fira+Code:wght@400;500;600&family=IM+Fell+English:ital@0;1&family=JetBrains+Mono:wght@400;500;600&family=Noto+Serif+JP:wght@400;500;600&family=Noto+Serif+SC:wght@400;500;600&family=Shippori+Mincho:wght@400;500;600&family=Spectral:wght@400;500;600&family=Yuji+Boku&family=Yuji+Syuku&family=Zen+Old+Mincho:wght@400;500;600&display=swap");
@import 'tailwindcss';

@plugin "@tailwindcss/typography";

@source "../../layout/**/*.njk";
@source "../../source/js/**/*.js";

@theme {
    --color-paper: #ffffff;
    --color-ink: #2b3036;
    --color-seal: #b0171a;
    --color-soft-border: rgba(17, 24, 39, 0.06);
    --color-focus-ring: rgba(31, 35, 40, 0.18);
    --color-scrollbar-track: #f5f6f7;
    --color-scrollbar-thumb: rgba(43, 48, 54, 0.32);
    --color-scrollbar-thumb-hover: rgba(43, 48, 54, 0.5);
    --color-scrollbar-border: rgba(43, 48, 54, 0.16);

    --font-code: 'Fira Code', 'Cascadia Code', 'JetBrains Mono', ui-monospace, monospace;
    --font-eng: 'Cormorant Garamond', 'IM Fell English', serif;
    --font-serif: 'Cardo', 'Spectral', 'Zen Old Mincho', 'Shippori Mincho',
    'Noto Serif JP', 'Noto Serif SC', serif;
    --font-title: 'Yuji Syuku', 'Yuji Boku', 'Zen Old Mincho', 'Noto Serif JP', serif;

    --shadow-paper: 0 1px 1px rgba(16, 24, 40, 0.06), 0 10px 30px rgba(16, 24, 40, 0.08),
    0 35px 70px rgba(16, 24, 40, 0.06);
    --shadow-ink: 0 4px 12px rgba(16, 24, 40, 0.14);
    --shadow-ink-pressed: 0 2px 8px rgba(16, 24, 40, 0.12);
    --ease-soft: cubic-bezier(0.2, 0.8, 0.2, 1);
}

@utility transition-menu {
    transition-property: max-height, opacity, transform;
}

@layer base {
    ::-webkit-scrollbar {
        width: 10px;
        height: 10px;
    }

    ::-webkit-scrollbar-track {
        background: linear-gradient(180deg, #fafafa 0%, var(--color-scrollbar-track) 60%, #f1f2f3 100%);
        border: 1px solid var(--color-soft-border);
        border-radius: 999px;
    }

    ::-webkit-scrollbar-thumb {
        background: linear-gradient(180deg, rgba(43, 48, 54, 0.38) 0%, var(--color-scrollbar-thumb) 100%);
        border: 2px solid var(--color-scrollbar-track);
        border-radius: 999px;
        box-shadow: inset 0 0 0 1px var(--color-scrollbar-border), 0 1px 2px rgba(15, 23, 42, 0.08);
    }

    ::-webkit-scrollbar-thumb:hover {
        background: linear-gradient(180deg, rgba(43, 48, 54, 0.58) 0%, var(--color-scrollbar-thumb-hover) 100%);
        box-shadow: inset 0 0 0 1px rgba(43, 48, 54, 0.28), 0 2px 4px rgba(15, 23, 42, 0.12);
    }

    ::-webkit-scrollbar-corner {
        background: var(--color-scrollbar-track);
    }

    * {
        scrollbar-color: var(--color-scrollbar-thumb) var(--color-scrollbar-track);
        scrollbar-width: thin;
    }

    html {
        color-scheme: light;
    }

    body {
        @apply font-serif antialiased;
        text-rendering: optimizeLegibility;
    }

    pre,
    code {
        font-family: var(--font-code);
    }

    @media (prefers-reduced-motion: reduce) {

        *,
        *::before,
        *::after {
            @apply transition-none scroll-auto;
        }
    }
}

@layer components {
    .seal-text {
        font-family: var(--font-title);
    }

    .fog-bg {
        background: radial-gradient(1200px 500px at 50% -100px, rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0) 65%), radial-gradient(900px 400px at 90% 10%, rgba(255, 255, 255, 0.35), rgba(255, 255, 255, 0) 55%), linear-gradient(180deg, #f4f5f6 0%, #f0f1f2 55%, #f4f5f6 100%);
    }

    .paper {
        @apply relative isolate border border-soft-border bg-paper shadow-paper;
    }

    .paper::before {
        content: "";
        @apply absolute inset-0 pointer-events-none mix-blend-multiply;
        z-index: -1;
        opacity: 0.22;
        filter: blur(0.2px);
        background-image: radial-gradient(circle at 20% 30%, rgba(0, 0, 0, 0.06) 0 0.6px, transparent 0.8px), radial-gradient(circle at 80% 70%, rgba(0, 0, 0, 0.05) 0 0.7px, transparent 0.9px), radial-gradient(circle at 40% 60%, rgba(0, 0, 0, 0.04) 0 0.6px, transparent 0.9px);
        background-size: 120px 120px, 160px 160px, 220px 220px;
        background-position: 0 0, 40px 30px, 80px 60px;
    }

    .btn-ink {
        @apply relative inline-flex items-center justify-center overflow-hidden rounded-xl border border-slate-300 px-4 py-2.5 text-sm text-slate-800 shadow-xs transition-all duration-200 ease-soft;
    }

    .btn-ink:hover {
        @apply border-slate-800/75 bg-ink text-white/95 shadow-ink saturate-105;
    }

    .btn-ink:active {
        @apply translate-y-px shadow-ink-pressed;
    }

    .menu-panel {
        @apply max-h-0 -translate-y-1.5 overflow-hidden opacity-0 transition-menu duration-260 ease-out;
    }

    .menu-panel[data-open="true"] {
        @apply translate-y-0 opacity-100;
        max-height: 70vh;
    }

    @media (prefers-reduced-motion: reduce) {
        .menu-panel {
            @apply translate-y-0;
        }

        .btn-ink:active {
            @apply translate-y-0;
        }
    }

    .site-title {
        @apply font-title tracking-wide text-slate-900;
        font-size: 2.2rem;
        line-height: 1.18;
    }

    .site-subtitle {
        @apply mt-3 text-sm leading-relaxed text-slate-500;
    }

    .page-title,
    .section-title {
        @apply font-bold leading-snug text-slate-900;
        font-size: 1.8rem;
    }

    .card-title {
        @apply font-bold leading-snug text-slate-900 transition-colors hover:text-slate-600;
        font-size: 1.35rem;
    }

    .section-heading {
        @apply mb-6 flex items-center gap-2 border-b border-slate-100 pb-2 text-xl font-bold text-slate-800;
    }

    .archive-item {
        @apply flex items-baseline gap-6;
    }

    .archive-date {
        @apply w-24 shrink-0 text-right text-sm font-medium text-slate-400 oldstyle-nums;
    }

    .archive-title {
        @apply text-base font-normal text-slate-700 transition-colors group-hover:text-slate-900;
    }

    .post-nav-link {
        @apply flex items-center gap-2 text-slate-600 transition-colors hover:text-slate-900;
        max-width: 45%;
    }

    .link-muted {
        @apply text-slate-600 underline-offset-4 decoration-slate-300 transition-colors hover:text-slate-800 hover:underline;
    }

    .link-underline {
        @apply underline-offset-4 decoration-slate-300 hover:underline;
    }

    .tag-pill {
        @apply inline-flex items-center rounded-md border border-slate-200 bg-slate-50 px-3 py-1.5 text-sm text-slate-600 transition-all duration-200 hover:border-slate-400 hover:text-slate-900;
    }

    .content-article {
        @apply py-2;
    }

    .section-shell {
        @apply mx-auto max-w-3xl;
    }

    .section-header {
        @apply mb-10 text-center;
    }

    .section-divider {
        @apply mt-8 border-t border-slate-200/70 pt-8 md:mt-10 md:pt-10;
    }

    .post-nav-title {
        @apply line-clamp-1 underline-offset-4 decoration-slate-300 group-hover:underline;
    }

    @media (min-width: 640px) {
        .site-title {
            font-size: 2.55rem;
        }

        .site-subtitle {
            font-size: 0.95rem;
        }

        .page-title,
        .section-title {
            font-size: 2rem;
        }

        .card-title {
            font-size: 1.45rem;
        }
    }

    @media (min-width: 768px) {
        .site-title {
            font-size: 3.1rem;
        }

        .page-title {
            font-size: 2.4rem;
        }

        .section-title {
            font-size: 2.2rem;
        }

        .card-title {
            font-size: 1.6rem;
        }
    }

    .pagination .page-number,
    .pagination .extend {
        @apply text-slate-500 underline-offset-4 decoration-slate-300 transition-colors hover:text-slate-900 hover:underline;
    }

    .pagination .page-number {
        @apply oldstyle-nums;
    }

    .pagination .page-number.current {
        @apply cursor-default text-slate-800 underline underline-offset-4 decoration-slate-600;
    }

    .pagination .space {
        @apply select-none text-slate-300;
    }

    /* LightGallery */
    .lg-outer {
        font-family: var(--font-serif);
        @apply text-gray-100;
        letter-spacing: 0.02em;
    }

    .lg-sub-html {
        font-size: 0.95rem;
        line-height: 1.7;
        padding: 0.75rem 1.25rem;
        letter-spacing: 0.04em;
    }

    .lg-sub-html p {
        margin: 0;
    }

    .lg-toolbar .lg-icon,
    .lg-next,
    .lg-prev {
        @apply text-gray-200;
        opacity: 0.85;
    }

    .lg-toolbar .lg-icon:hover,
    .lg-next:hover,
    .lg-prev:hover {
        @apply text-slate-50;
        opacity: 1;
    }

    /* Force safe colors to prevent oklch inheritance/parsing issues */
    #disqus_thread,
    #disqus_recommendations {
        @apply bg-paper text-ink;
    }
}

@layer utilities {
    .focus-elegant:focus-visible {
        @apply border-slate-800/20 outline-none ring-2 ring-white/85 ring-offset-2 ring-offset-focus-ring;
    }

    .prose-shiro {
        @apply mx-auto font-serif leading-relaxed prose prose-slate;
        --tw-prose-body: var(--color-slate-800);
        --tw-prose-headings: var(--color-ink);
        --tw-prose-lead: var(--color-slate-600);
        --tw-prose-links: var(--color-slate-800);
        --tw-prose-bold: var(--color-ink);
        --tw-prose-counters: var(--color-slate-500);
        --tw-prose-bullets: var(--color-slate-300);
        --tw-prose-hr: var(--color-slate-200);
        --tw-prose-quotes: var(--color-slate-600);
        --tw-prose-quote-borders: var(--color-slate-300);
        --tw-prose-captions: var(--color-slate-500);
        --tw-prose-code: var(--color-seal);
        --tw-prose-pre-code: var(--color-slate-200);
        --tw-prose-pre-bg: var(--color-slate-900);
        --tw-prose-th-borders: var(--color-slate-300);
        --tw-prose-td-borders: var(--color-slate-200);
    }

    .prose-shiro .highlight:not(.not-prose) {
        @apply my-6 overflow-x-auto rounded-lg border border-slate-100 bg-slate-50 text-slate-700 shadow-sm;
    }

    .prose-shiro .highlight table {
        @apply my-0 w-full border-collapse;
    }

    .prose-shiro .highlight td {
        @apply border-0 p-0;
    }

    .prose-shiro .highlight td.gutter {
        @apply w-10 min-w-10 select-none border-r border-slate-200 bg-slate-100 text-right text-slate-400;
    }

    .prose-shiro .highlight pre {
        @apply m-0 bg-transparent text-sm leading-relaxed text-inherit;
    }

    .prose-shiro code {
        padding-inline: 0.25em;
    }

    .prose-shiro code::before,
    .prose-shiro code::after {
        content: "";
    }

    .text-footnote {
        font-size: 0.7rem;
    }

    .tracking-note {
        letter-spacing: 0.2em;
    }

    .max-h-menu {
        max-height: 60vh;
    }

    .max-w-divider {
        max-width: 120px;
    }
}
