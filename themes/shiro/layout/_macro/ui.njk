{% macro svg_filters() %}
<svg width="0" height="0" class="absolute pointer-events-none" aria-hidden="true">
    <defs>
        <filter id="seal-roughness" x="-20%" y="-20%" width="140%" height="140%">
            <feTurbulence type="turbulence" baseFrequency="0.05" numOctaves="2" result="noise" />
            <feDisplacementMap in="SourceGraphic" in2="noise" scale="3" />
        </filter>
        <filter id="text-erosion">
            <feTurbulence type="fractalNoise" baseFrequency="0.15" numOctaves="1" result="noise" />
            <feDisplacementMap in="SourceGraphic" in2="noise" scale="1.5" />
        </filter>
    </defs>
</svg>
{% endmacro %}

{% macro seal(title="白") %}
<svg width="52" height="52" viewBox="0 0 100 100" aria-label="朱印：{{ title }}" title="朱印：{{ title }}"
    xmlns="http://www.w3.org/2000/svg">
    <path d="M15,12 Q50,5 85,12 Q95,50 88,88 Q50,95 12,88 Q5,50 15,12 Z"
        fill="var(--color-seal)" filter="url(#seal-roughness)" opacity="0.92" />
    <text x="50" y="50" text-anchor="middle" dominant-baseline="central"
        font-size="42" fill="rgba(255,255,255,0.92)" filter="url(#text-erosion)"
        class="seal-text select-none">{{ title }}</text>
</svg>
{% endmacro %}

{% macro divider(class="my-4") %}
<div class="{{ class }} flex items-center justify-center gap-3" aria-hidden="true">
    <div class="h-px flex-1 bg-linear-to-r from-transparent to-slate-300 max-w-divider"></div>
    <svg class="h-4 w-10 flex-none text-slate-300" viewBox="0 0 40 10">
        <circle cx="20" cy="5" r="3" fill="currentColor" opacity="0.9" />
        <circle cx="4" cy="5" r="1.5" fill="currentColor" opacity="0.6" />
        <circle cx="36" cy="5" r="1.5" fill="currentColor" opacity="0.6" />
    </svg>
    <div class="h-px flex-1 bg-linear-to-l from-transparent to-slate-300 max-w-divider"></div>
</div>
{% endmacro %}

{% macro icon_chevron_down(class="h-4 w-4") %}
<svg class="{{ class }} text-slate-500 transition-transform duration-200" id="menuChevron"
    viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
    <path fill-rule="evenodd"
        d="M5.23 7.21a.75.75 0 0 1 1.06.02L10 10.94l3.71-3.71a.75.75 0 1 1 1.06 1.06l-4.24 4.24a.75.75 0 0 1-1.06 0L5.21 8.29a.75.75 0 0 1 .02-1.08z"
        clip-rule="evenodd" />
</svg>
{% endmacro %}

{% macro icon_folder(class="w-4 h-4 text-slate-400 shrink-0") %}
<svg class="{{ class }}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
</svg>
{% endmacro %}

{% macro icon_nav_arrow(class="w-4 h-4 text-slate-400 shrink-0") %}
<svg class="{{ class }}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
</svg>
{% endmacro %}

{% macro icon_rss(class="w-3 h-3 group-hover:text-orange-500 transition-colors duration-300") %}
<svg class="{{ class }}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M4 11a9 9 0 0 1 9 9"></path>
    <path d="M4 4a16 16 0 0 1 16 16"></path>
    <circle cx="5" cy="19" r="1"></circle>
</svg>
{% endmacro %}

{% macro icon_empty(class="h-10 w-10 mx-auto opacity-30") %}
<svg class="{{ class }}" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
    <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 006 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 016 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 016-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0018 18a8.967 8.967 0 00-6 2.292m0-14.25v14.25" />
</svg>
{% endmacro %}

{% macro meta(post, show_all_cats=true, class="mt-2") %}
<div class="{{ class }} flex items-center justify-center gap-4 text-sm text-slate-500">
    <div class="flex items-center gap-1.5">
        <svg class="w-4 h-4 text-slate-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <a href="{{ url_for('archives/' + date(post.date, 'YYYY')) + '/' }}" class="oldstyle-nums link-muted">{{ date(post.date, 'YYYY/MM/DD') }}</a>
    </div>
    {% if post.categories and post.categories.length > 0 %}
        <span class="text-slate-300" aria-hidden="true">•</span>
        <div class="flex items-center gap-1.5">
            <svg class="w-4 h-4 text-slate-400 shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
            </svg>
            {% if show_all_cats %}
                {% for cat in post.categories.toArray() %}
                    <a class="link-muted" href="{{ url_for(cat.path) }}">{{ cat.name }}</a>
                    {% if not loop.last %}<span class="text-slate-300">/</span>{% endif %}
                {% endfor %}
            {% else %}
                <a class="link-muted" href="{{ url_for(post.categories.data[0].path) }}">{{ post.categories.data[0].name }}</a>
            {% endif %}
        </div>
    {% endif %}
</div>
{% endmacro %}

{% macro render_tag(tag, show_count=false) %}
<a href="{{ url_for(tag.path) }}" class="tag-pill">
    <span class="w-1.5 h-1.5 rounded-full bg-slate-400 mr-2"></span>
    {{ tag.name }}
    {% if show_count %}
        <span class="text-slate-400 ml-1 text-xs">{{ tag.length }}</span>
    {% endif %}
</a>
{% endmacro %}

{% macro toc_button(content) %}
{% if content and content.trim() %}
<button id="tocFab" aria-expanded="false" aria-controls="tocPanel" title="Index">
    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
        <rect x="3" y="5" width="18" height="2" rx="1" fill="currentColor" />
        <rect x="3" y="11" width="18" height="2" rx="1" fill="currentColor" />
        <rect x="3" y="17" width="18" height="2" rx="1" fill="currentColor" />
    </svg>
</button>
<div id="tocOverlay" data-open="false" aria-hidden="true"></div>
<aside id="tocPanel" role="navigation" aria-hidden="true" data-open="false">
    <nav class="toc-content">
        {{ content }}
    </nav>
</aside>
{% endif %}
{% endmacro %}
